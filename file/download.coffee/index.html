<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Download.coffee - node-nikita</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Download.coffee";
    var mkdocs_page_input_path = "file/download.coffee.md";
    var mkdocs_page_url = "/file/download.coffee/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../context.coffee/" class="icon icon-home"> node-nikita</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../context.coffee/">Context.coffee</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../index.coffee/">Index.coffee</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../registry.coffee/">Registry.coffee</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Alt</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alt/ldap_acl.coffee/">Ldap acl.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../alt/ldap_index.coffee/">Ldap index.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Connection</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../connection/assert.coffee/">Assert.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../connection/wait.coffee/">Wait.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Core</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/assert.coffee/">Assert.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/ping.coffee/">Ping.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Kv</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/kv/engine.coffee/">Engine.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/kv/get.coffee/">Get.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/kv/set.coffee/">Set.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Engines</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/kv/engines/memory.coffee/">Memory.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Cron</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cron/add.coffee/">Add.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../cron/remove.coffee/">Remove.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Db</span></li>

        
            
    <ul class="subnav">
    <li><span>Database</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/database/exists.coffee/">Exists.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/database/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/database/remove.coffee/">Remove.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/database/wait.coffee/">Wait.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Schema</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/schema/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/schema/remove.coffee/">Remove.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>User</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/user/exists.coffee/">Exists.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/user/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../db/user/remove.coffee/">Remove.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Docker</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/build.coffee/">Build.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/checksum.coffee/">Checksum.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/cp.coffee/">Cp.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/exec.coffee/">Exec.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/kill.coffee/">Kill.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/load.coffee/">Load.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/login.coffee/">Login.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/logout.coffee/">Logout.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/pause.coffee/">Pause.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/pull.coffee/">Pull.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/restart.coffee/">Restart.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/rm.coffee/">Rm.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/rmi.coffee/">Rmi.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/run.coffee/">Run.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/save.coffee/">Save.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/service.coffee/">Service.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/start.coffee/">Start.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/status.coffee/">Status.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/stop.coffee/">Stop.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/unpause.coffee/">Unpause.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/volume_create.coffee/">Volume create.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/volume_rm.coffee/">Volume rm.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/wait.coffee/">Wait.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Compose</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../docker/compose/index.coffee/">Index.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>File</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../assert.coffee/">Assert.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cache.coffee/">Cache.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cson.coffee/">Cson.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Download.coffee</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#nikitafiledownloadoptions-callback">nikita.file.download(options, [callback])</a></li>
                
                    <li><a class="toctree-l4" href="#options">Options</a></li>
                
                    <li><a class="toctree-l4" href="#callback-parameters">Callback parameters</a></li>
                
                    <li><a class="toctree-l4" href="#file-example">File example</a></li>
                
                    <li><a class="toctree-l4" href="#http-example">HTTP example</a></li>
                
                    <li><a class="toctree-l4" href="#ftp-example">FTP example</a></li>
                
                    <li><a class="toctree-l4" href="#source-code">Source Code</a></li>
                
                    <li><a class="toctree-l4" href="#module-dependencies">Module Dependencies</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ini.coffee/">Ini.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../json.coffee/">Json.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../render.coffee/">Render.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../touch.coffee/">Touch.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../upload.coffee/">Upload.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../yaml.coffee/">Yaml.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Properties</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../properties/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../properties/read.coffee/">Read.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Types</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../types/ceph_conf.coffee/">Ceph conf.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../types/locale_gen.coffee/">Locale gen.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../types/pacman_conf.coffee/">Pacman conf.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../types/ssh_authorized_keys.coffee/">Ssh authorized keys.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../types/yum_repo.coffee/">Yum repo.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Etc group</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../types/etc_group/read.coffee/">Read.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Etc passwd</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../types/etc_passwd/read.coffee/">Read.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Fs</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/chmod.coffee/">Chmod.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/chown.coffee/">Chown.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/copy.coffee/">Copy.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/createReadStream.coffee/">createReadStream.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/exists.coffee/">Exists.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/lstat.coffee/">Lstat.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/mkdir.coffee/">Mkdir.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/readFile.coffee/">readFile.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/readlink.coffee/">Readlink.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/rename.coffee/">Rename.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/rmdir.coffee/">Rmdir.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/stat.coffee/">Stat.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/symlink.coffee/">Symlink.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/unlink.coffee/">Unlink.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../fs/writeFile.coffee/">writeFile.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Java</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../java/keystore_add.coffee/">Keystore add.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../java/keystore_remove.coffee/">Keystore remove.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Krb5</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../krb5/addprinc.coffee/">Addprinc.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../krb5/delprinc.coffee/">Delprinc.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../krb5/ktadd.coffee/">Ktadd.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../krb5/ticket.coffee/">Ticket.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Ktutil</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../krb5/ktutil/add.coffee/">Add.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Ldap</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ldap/acl.coffee/">Acl.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ldap/add.coffee/">Add.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ldap/delete.coffee/">Delete.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ldap/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ldap/schema.coffee/">Schema.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ldap/user.coffee/">User.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Log</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../log/cli.coffee/">Cli.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../log/csv.coffee/">Csv.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../log/fs.coffee/">Fs.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../log/md.coffee/">Md.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../log/stream.coffee/">Stream.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Misc</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/conditions.coffee/">Conditions.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/db.coffee/">Db.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/diff.coffee/">Diff.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/docker.coffee/">Docker.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/krb5.coffee/">Krb5.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/ldap.coffee/">Ldap.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/os.coffee/">Os.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../misc/pidfile_running.coffee/">Pidfile running.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Service</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/assert.coffee/">Assert.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/discover.coffee/">Discover.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/init.coffee/">Init.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/install.coffee/">Install.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/remove.coffee/">Remove.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/restart.coffee/">Restart.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/start.coffee/">Start.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/startup.coffee/">Startup.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/status.coffee/">Status.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../service/stop.coffee/">Stop.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Ssh</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ssh/close.coffee/">Close.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ssh/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ssh/open.coffee/">Open.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ssh/root.coffee/">Root.coffee</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>System</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/cgroups.coffee/">Cgroups.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/chmod.coffee/">Chmod.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/chown.coffee/">Chown.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/copy.coffee/">Copy.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/discover.coffee/">Discover.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/limits.coffee/">Limits.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/link.coffee/">Link.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/mkdir.coffee/">Mkdir.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/mod.coffee/">Mod.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/move.coffee/">Move.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/remove.coffee/">Remove.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/tmpfs.coffee/">Tmpfs.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/uid_gid.coffee/">Uid gid.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Execute</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/execute/assert.coffee/">Assert.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/execute/index.coffee/">Index.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Group</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/group/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/group/remove.coffee/">Remove.coffee</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>User</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/user/index.coffee/">Index.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/user/remove.coffee/">Remove.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Tools</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/backup.coffee/">Backup.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/compress.coffee/">Compress.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/extract.coffee/">Extract.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/git.coffee/">Git.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/iptables.coffee/">Iptables.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/repo.coffee/">Repo.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/sysctl.coffee/">Sysctl.coffee</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Rubygems</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/rubygems/fetch.coffee/">Fetch.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/rubygems/install.coffee/">Install.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tools/rubygems/remove.coffee/">Remove.coffee</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Wait</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../wait/execute.coffee/">Execute.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../wait/exist.coffee/">Exist.coffee</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../wait/index.coffee/">Index.coffee</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../context.coffee/">node-nikita</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../context.coffee/">Docs</a> &raquo;</li>
    
      
        
          <li>File &raquo;</li>
        
      
    
    <li>Download.coffee</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="nikitafiledownloadoptions-callback"><code>nikita.file.download(options, [callback])</code></h1>
<p>Download files using various protocols.</p>
<p>In local mode (with an SSH connection), the <code>http</code> protocol is handled with the
"request" module when executed locally, the <code>ftp</code> protocol is handled with the
"jsftp" and the <code>file</code> protocol is handle with the native <code>fs</code> module.</p>
<p>The behavior of download may be confusing wether you are running over SSH or
not. It's philosophy mostly rely on the target point of view. When download
run, the target is local, compared to the upload function where target
is remote.</p>
<p>A checksum may provided with the option "sha256", "sha1" or "md5" to validate the uploaded
file signature.</p>
<p>Caching is active if "cache_dir" or "cache_file" are defined to anything but false.
If cache_dir is not a string, default value is './'
If cache_file is not a string, default is source basename.</p>
<p>Nikita resolve the path from "cache_dir" to "cache_file", so if cache_file is an
absolute path, "cache_dir" will be ignored</p>
<p>If no cache is used, signature validation is only active if a checksum is
provided.</p>
<p>If cache is used, signature validation is always active, and md5sum is automatically
calculated if neither sha256, sh1 nor md5 is provided.</p>
<h2 id="options">Options</h2>
<ul>
<li><code>cache</code> (boolean) <br />
  Activate the cache, default to true if either "cache_dir" or "cache_file" is
  activated.   </li>
<li><code>cache_dir</code> (path) <br />
  If local_cache is not a string, the cache file path is resolved from cache
  dir and cache file. <br />
  By default: './'   </li>
<li><code>cache_file</code> (string | boolean) <br />
  Cache the file on the executing machine, equivalent to cache unless an ssh
  connection is provided. If a string is provided, it will be the cache path. <br />
  By default: basename of source   </li>
<li><code>force</code> (boolean) <br />
  Overwrite target file if it exists.   </li>
<li><code>force_cache</code> (boolean) <br />
  Force cache overwrite if it exists   </li>
<li><code>gid</code> <br />
  Group name or id who owns the target file.   </li>
<li><code>headers</code> (array) <br />
  Extra  header  to include in the request when sending HTTP to a server.   </li>
<li><code>location</code> (boolean) <br />
  If the server reports that the requested page has moved to a different
  location (indicated with a Location: header and a 3XX response code), this
  option will make curl redo the request on the new place.   </li>
<li><code>md5</code> (MD5 Hash) <br />
  Hash of the file using MD5. Used to check integrity</li>
<li><code>mode</code> (octal mode) <br />
  Permissions of the target. If specified, nikita will chmod after download   </li>
<li><code>proxy</code> (string) <br />
  Use the specified HTTP proxy. If the port number is not specified, it is
  assumed at port 1080. See curl(1) man page.   </li>
<li><code>sha1</code> (SHA-1 Hash) <br />
  Hash of the file using SHA-1. Used to check integrity.   </li>
<li><code>sha256</code> (SHA-256 Hash) <br />
  Hash of the file using SHA-256. Used to check integrity.   </li>
<li><code>source</code> (path) <br />
  File, HTTP URL, FTP, GIT repository. File is the default protocol if source
  is provided without any.   </li>
<li><code>target</code> (path) <br />
  Path where the file is downloaded.   </li>
<li><code>uid</code> <br />
  User name or id who owns the target file.   </li>
</ul>
<h2 id="callback-parameters">Callback parameters</h2>
<ul>
<li><code>err</code> <br />
  Error object if any.   </li>
<li><code>downloaded</code> <br />
  Value is "true" if file was downloaded.   </li>
</ul>
<h2 id="file-example">File example</h2>
<pre><code class="js">require('nikita').download({
  source: 'file://path/to/something',
  target: 'node-sigar.tgz'
}, function(err, downloaded){
  console.log(err ? err.message : 'File was downloaded: ' + downloaded);
});
</code></pre>

<h2 id="http-example">HTTP example</h2>
<pre><code class="coffee">nikita.download
  source: 'https://github.com/wdavidw/node-nikita/tarball/v0.0.1'
  target: 'node-sigar.tgz'
, (err, downloaded) -&gt; ...
</code></pre>

<h2 id="ftp-example">FTP example</h2>
<pre><code class="coffee">nikita.download
  source: 'ftp://myhost.com:3334/wdavidw/node-nikita/tarball/v0.0.1'
  target: 'node-sigar.tgz'
  user: 'johndoe',
  pass: '12345'
, (err, downloaded) -&gt; ...
</code></pre>

<h2 id="source-code">Source Code</h2>
<pre><code>module.exports = (options) -&gt;
  options.log message: 'Entering file.download', level: 'DEBUG', module: 'nikita/lib/file/download'
  # SSH connection
  ssh = @ssh options.ssh
  # Options
  throw Error "Missing source: #{options.source}" unless options.source
  throw Error "Missing target: #{options.target}" unless options.target
  options.source = options.source.substr 7 if /^file:\/\//.test options.source
  stageDestination = null
  if options.md5?
    throw Error "Invalid MD5 Hash:#{options.md5}" unless typeof options.md5 in ['string', 'boolean']
    algo = 'md5'
    source_hash = options.md5
  else if options.sha1?
    throw Error "Invalid SHA-1 Hash:#{options.sha1}" unless typeof options.sha1 in ['string', 'boolean']
    algo = 'sha1'
    source_hash = options.sha1
  else if options.sha256?
    throw Error "Invalid SHA-256 Hash:#{options.sha256}" unless typeof options.sha256 in ['string', 'boolean']
    algo = 'sha256'
    source_hash = options.sha256
  else
    algo = 'md5'
  protocols_http = ['http:', 'https:']
  protocols_ftp = ['ftp:', 'ftps:']
  # hash_info = null
  options.log message: "Using force: #{JSON.stringify options.force}", level: 'DEBUG', module: 'nikita/lib/file/download'
  source_url = url.parse options.source
  # Disable caching if source is a local file and cache isnt exlicitly set by user
  options.cache = false if not options.cache? and source_url.protocol is null
  options.cache ?= !!(options.cache_dir or options.cache_file)
  @call # Accelarator in case we know the target signature
    if: typeof source_hash is 'string'
    shy: true
  , (_, callback) -&gt;
      options.log message: "Shortcircuit check if provided hash match target", level: 'WARN', module: 'nikita/lib/file/download'
      file.hash ssh, options.target, algo, (err, hash) =&gt;
        err = null if err?.code is 'ENOENT'
        callback err, source_hash is hash
    , (err, end) -&gt;
      return unless end
      options.log message: "Destination with valid signature, download aborted", level: 'INFO', module: 'nikita/lib/file/download'
      @end()
  @file.cache # Download the file and place it inside local cache
    if: options.cache
    ssh: false
    source: options.source
    cache_dir: options.cache_dir
    cache_file: options.cache_file
    headers: options.headers
    md5: options.md5
    proxy: options.proxy
    location: options.location
  , (err, cached, file) -&gt;
    throw err if err
    options.source = file if options.cache
    source_url = url.parse options.source
  @fs.stat ssh: options.ssh, target: options.target, relax: true, (err, stat) -&gt;
    throw err if err and err.code isnt 'ENOENT'
    if stat?.isDirectory()
      options.log message: "Destination is a directory", level: 'DEBUG', module: 'nikita/lib/file/download'
      options.target = path.join options.target, path.basename options.source
    stageDestination = "#{options.target}.#{Date.now()}#{Math.round(Math.random()*1000)}"
  @call
    if: -&gt; source_url.protocol in protocols_http
  , -&gt;
      options.log message: "HTTP Download", level: 'DEBUG', module: 'nikita/lib/file/download'
      fail = if options.fail then "--fail" else ''
      k = if source_url.protocol is 'https:' then '-k' else ''
      cmd = "curl #{fail} #{k} -s #{options.source} -o #{stageDestination}"
      cmd += " -x #{options.proxy}" if options.proxy
      options.log message: "Download file from url using curl", level: 'INFO', module: 'nikita/lib/file/download'
      @system.mkdir
        shy: true
        target: path.dirname stageDestination
      @system.execute
        cmd: cmd
        shy: true
      @call
        if: typeof source_hash is 'string'
      , (_, callback) -&gt;
          file.hash ssh, stageDestination, algo, (err, hash) =&gt;
            return callback Error "Invalid downloaded checksum, found '#{hash}' instead of '#{source_hash}'" if source_hash isnt hash
            callback()
      @call (_, callback) -&gt;
        file.compare_hash (if options.cache then null else ssh), stageDestination, ssh, options.target, algo, (err, match, hash1, hash2) -&gt;
          options.log message: "Hash dont match, source is '#{hash1}' and target is '#{hash2}'", level: 'WARN', module: 'nikita/lib/file/download' unless match
          options.log message: "Hash matches as '#{hash1}'", level: 'INFO', module: 'nikita/lib/file/download' if match
          callback err, not match
      @system.remove
        unless: -&gt; @status -1
        shy: true
        target: stageDestination
  @call
    if: -&gt; source_url.protocol not in protocols_http and not ssh
  , -&gt;
      options.log message: "File Download without ssh (with or without cache)", level: 'DEBUG', module: 'nikita/lib/file/download'
      @call (_, callback) -&gt;
        file.compare_hash null, options.source, null, options.target, algo, (err, match, hash1, hash2) -&gt;
          options.log message: "Hash dont match, source is '#{hash1}' and target is '#{hash2}'", level: 'WARN', module: 'nikita/lib/file/download' unless match
          options.log message: "Hash matches as '#{hash1}'", level: 'INFO', module: 'nikita/lib/file/download' if match
          callback err, not match
      @system.mkdir
        if: -&gt; @status -1
        shy: true
        target: path.dirname stageDestination
      @fs.copy
        if: -&gt; @status -2
        source: options.source
        target: stageDestination
  @call
    if: -&gt; source_url.protocol not in protocols_http and ssh
  , -&gt;
      options.log message: "File Download with ssh (with or without cache)", level: 'DEBUG', module: 'nikita/lib/file/download'
      @call (_, callback) -&gt;
        file.compare_hash null, options.source, ssh, options.target, algo, (err, match, hash1, hash2) -&gt;
          options.log message: "Hash dont match, source is '#{hash1}' and target is '#{hash2}'", level: 'WARN', module: 'nikita/lib/file/download' unless match
          options.log message: "Hash matches as '#{hash1}'", level: 'INFO', module: 'nikita/lib/file/download' if match
          callback err, not match
      @system.mkdir
        if: -&gt; @status -1
        shy: true
        target: path.dirname stageDestination
      @call
        if: -&gt; @status -2
      , (_, callback) -&gt;
          options.log message: "Local source: '#{options.source}'", level: 'INFO', module: 'nikita/lib/file/download'
          options.log message: "Remote target: '#{stageDestination}'", level: 'INFO', module: 'nikita/lib/file/download'
          # TODO: incompatible with sudo
          rs = fs.createReadStream options.source
          rs.on 'error', (err) -&gt;
            console.log 'rs on error', err
          ssh2fs.writeFile ssh, stageDestination, rs, (err) -&gt;
            options.log "Upload failed from local to remote" if err
            callback err
  @call -&gt;
    options.log message: "Unstage downloaded file", level: 'DEBUG', module: 'nikita/lib/file/download'
    @system.move
      if: @status()
      source: stageDestination
      target: options.target
    @system.chmod
      target: options.target
      mode: options.mode
      if: options.mode?
    @system.chown
      target: options.target
      uid: options.uid
      gid: options.gid
      if: options.uid? or options.gid?
</code></pre>
<h2 id="module-dependencies">Module Dependencies</h2>
<pre><code>fs = require 'fs'
ssh2fs = require 'ssh2-fs'
path = require('path').posix # need to detect ssh connection
url = require 'url'
curl = require '../misc/curl'
file = require '../misc/file'
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../index.coffee/" class="btn btn-neutral float-right" title="Index.coffee">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../cson.coffee/" class="btn btn-neutral" title="Cson.coffee"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../cson.coffee/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../index.coffee/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
